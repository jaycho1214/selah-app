---
phase: 03-bible-reading
plan: 06
type: execute
wave: 4
depends_on: ["03-04"]
files_modified:
  - app/bookmarks.tsx
  - components/bible/bookmark-item.tsx
  - app/(tabs)/_layout.tsx
autonomous: true

must_haves:
  truths:
    - "User can view list of all bookmarked verses"
    - "Bookmarks show verse reference and preview"
    - "Tapping bookmark navigates to that verse"
    - "User can remove bookmark from list"
  artifacts:
    - path: "app/bookmarks.tsx"
      provides: "Bookmarks list screen"
    - path: "components/bible/bookmark-item.tsx"
      provides: "Individual bookmark row"
      exports: ["BookmarkItem"]
  key_links:
    - from: "app/bookmarks.tsx"
      to: "lib/stores/annotations-store.ts"
      via: "useAnnotationsStore for bookmarks"
      pattern: "useAnnotationsStore"
    - from: "app/bookmarks.tsx"
      to: "expo-router"
      via: "router.push to Bible verse"
      pattern: "router.push.*bible"
---

<objective>
Create bookmarks list screen accessible from tab navigation.

Purpose: Bookmarks provide quick access to saved verses (BIBL-04). Users need to view, navigate to, and manage their bookmarks.

Output: Bookmarks screen with list of saved verses, navigation to verse, and delete action.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-bible-reading/03-02-SUMMARY.md
@.planning/phases/03-bible-reading/03-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create BookmarkItem component</name>
  <files>components/bible/bookmark-item.tsx</files>
  <action>
Create `components/bible/bookmark-item.tsx`:

```typescript
import { View, Text, Pressable } from 'react-native';
import { Trash2 } from 'lucide-react-native';
import { BIBLE_BOOK_DETAILS } from '@/lib/bible/constants';
import type { BibleBook } from '@/lib/bible/types';

interface BookmarkItemProps {
  verseId: string; // Format: "KJV:GENESIS:1:1"
  verseText?: string;
  createdAt: number;
  onPress: () => void;
  onDelete: () => void;
}

// Parse verse ID into parts
function parseVerseId(verseId: string) {
  const parts = verseId.split(':');
  if (parts.length !== 4) return null;
  return {
    translation: parts[0],
    book: parts[1] as BibleBook,
    chapter: parseInt(parts[2], 10),
    verse: parseInt(parts[3], 10),
  };
}

export function BookmarkItem({
  verseId,
  verseText,
  createdAt,
  onPress,
  onDelete,
}: BookmarkItemProps) {
  const parsed = parseVerseId(verseId);
  if (!parsed) return null;

  const bookDetails = BIBLE_BOOK_DETAILS[parsed.book];
  const reference = `${bookDetails?.name ?? parsed.book} ${parsed.chapter}:${parsed.verse}`;
  const dateStr = new Date(createdAt).toLocaleDateString();

  return (
    <Pressable
      onPress={onPress}
      className="flex-row items-center px-4 py-3 border-b border-border active:bg-muted/50"
    >
      <View className="flex-1">
        <Text className="text-foreground text-base font-medium">{reference}</Text>
        {verseText && (
          <Text
            className="text-muted-foreground text-sm mt-1"
            numberOfLines={2}
          >
            {verseText}
          </Text>
        )}
        <Text className="text-muted-foreground text-xs mt-1">{dateStr}</Text>
      </View>

      <Pressable
        onPress={(e) => {
          e.stopPropagation();
          onDelete();
        }}
        className="p-2 -mr-2"
        hitSlop={8}
      >
        <Trash2 size={18} className="text-muted-foreground" />
      </Pressable>
    </Pressable>
  );
}
```

The component parses the verse ID to display a human-readable reference (e.g., "Genesis 1:1" instead of "KJV:GENESIS:1:1").
  </action>
  <verify>
- File exports `BookmarkItem` component
- Component parses verse ID to show readable reference
- Shows verse text preview and date
- Has delete button with Trash2 icon
- TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>BookmarkItem component displays bookmark with reference and actions</done>
</task>

<task type="auto">
  <name>Task 2: Create Bookmarks screen</name>
  <files>app/bookmarks.tsx</files>
  <action>
Create `app/bookmarks.tsx`:

```typescript
import { useCallback, useMemo } from 'react';
import { View, Text } from 'react-native';
import { FlashList } from '@shopify/flash-list';
import { Stack, router } from 'expo-router';
import { SafeAreaView } from 'react-native-safe-area-context';
import { BookmarkItem } from '@/components/bible/bookmark-item';
import { useAnnotationsStore } from '@/lib/stores/annotations-store';
import type { BibleBook } from '@/lib/bible/types';

// Parse verse ID into routing params
function parseVerseId(verseId: string) {
  const parts = verseId.split(':');
  if (parts.length !== 4) return null;
  return {
    translation: parts[0],
    book: parts[1] as BibleBook,
    chapter: parseInt(parts[2], 10),
    verse: parseInt(parts[3], 10),
  };
}

export default function BookmarksScreen() {
  const { bookmarks, removeBookmark } = useAnnotationsStore();

  // Convert Record to sorted array (newest first)
  const bookmarkList = useMemo(() => {
    return Object.values(bookmarks).sort((a, b) => b.createdAt - a.createdAt);
  }, [bookmarks]);

  const handleBookmarkPress = useCallback((verseId: string) => {
    const parsed = parseVerseId(verseId);
    if (!parsed) return;
    router.push(`/bible/${parsed.book}/${parsed.chapter}`);
    // TODO: Scroll to specific verse within chapter
  }, []);

  const handleDeleteBookmark = useCallback(
    (verseId: string) => {
      removeBookmark(verseId);
    },
    [removeBookmark]
  );

  const renderItem = useCallback(
    ({ item }: { item: (typeof bookmarkList)[number] }) => (
      <BookmarkItem
        verseId={item.verseId}
        createdAt={item.createdAt}
        onPress={() => handleBookmarkPress(item.verseId)}
        onDelete={() => handleDeleteBookmark(item.verseId)}
      />
    ),
    [handleBookmarkPress, handleDeleteBookmark]
  );

  const keyExtractor = useCallback(
    (item: (typeof bookmarkList)[number]) => item.verseId,
    []
  );

  return (
    <SafeAreaView className="flex-1 bg-background" edges={['top']}>
      <Stack.Screen
        options={{
          title: 'Bookmarks',
          headerLargeTitle: true,
        }}
      />

      {bookmarkList.length === 0 ? (
        <View className="flex-1 items-center justify-center p-8">
          <Text className="text-muted-foreground text-center text-lg">
            No bookmarks yet
          </Text>
          <Text className="text-muted-foreground text-center text-sm mt-2">
            Tap a verse while reading to add a bookmark
          </Text>
        </View>
      ) : (
        <FlashList
          data={bookmarkList}
          renderItem={renderItem}
          keyExtractor={keyExtractor}
          estimatedItemSize={80}
        />
      )}
    </SafeAreaView>
  );
}
```

This screen reads from the annotations store and displays bookmarks sorted by date. Tapping navigates to the Bible chapter containing that verse.
  </action>
  <verify>
- File exports default Bookmarks screen
- Shows empty state when no bookmarks
- Lists bookmarks sorted by date (newest first)
- Tapping bookmark navigates to `/bible/{book}/{chapter}`
- Delete button removes bookmark
- TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Bookmarks screen lists and manages saved verses</done>
</task>

<task type="auto">
  <name>Task 3: Add bookmarks to navigation</name>
  <files>app/(tabs)/_layout.tsx</files>
  <action>
The bookmarks screen should be accessible via a header button or from the profile tab. For now, add it as a modal route accessible from anywhere.

Check existing `app/(tabs)/_layout.tsx` and add bookmarks icon to header or as accessible route.

Option 1: Add to tab bar (if space allows)
Option 2: Add as header button on home/Bible screens
Option 3: Add to profile tab menu

For v1, add a simple entry point from the home screen. Update `app/(tabs)/index.tsx`:

```typescript
// Add to existing home screen
import { Bookmark } from 'lucide-react-native';

// In the component, add a button to access bookmarks
<Pressable
  onPress={() => router.push('/bookmarks')}
  className="flex-row items-center justify-between bg-card rounded-xl p-4 shadow-sm border border-border mt-4"
>
  <View className="flex-row items-center gap-3">
    <Bookmark size={20} className="text-primary" />
    <Text className="text-foreground text-base">Bookmarks</Text>
  </View>
  <Text className="text-muted-foreground">
    {Object.keys(bookmarks).length}
  </Text>
</Pressable>
```

Add to home screen imports:
```typescript
import { useAnnotationsStore } from '@/lib/stores/annotations-store';
```

And in component:
```typescript
const { bookmarks } = useAnnotationsStore();
```

Also verify the route is registered. Since `app/bookmarks.tsx` exists at root, it should work with `router.push('/bookmarks')`.
  </action>
  <verify>
- Bookmarks accessible from home screen
- Route `/bookmarks` works
- Count shows in home screen button
- TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Bookmarks screen accessible from navigation</done>
</task>

</tasks>

<verification>
1. TypeScript check: `npx tsc --noEmit` - no errors
2. Bookmark a verse: In Bible reader, tap verse, tap Bookmark
3. View bookmarks: Go to home, tap Bookmarks button
4. Navigate from bookmark: Tap a bookmark, verify it opens Bible at that chapter
5. Delete bookmark: Tap trash icon, bookmark disappears
</verification>

<success_criteria>
- User can access bookmarks list (BIBL-04)
- Bookmarks show verse reference (Genesis 1:1 format)
- Bookmarks sorted by date (newest first)
- Tapping bookmark navigates to verse
- Can delete bookmarks from list
- Empty state shows when no bookmarks
</success_criteria>

<output>
After completion, create `.planning/phases/03-bible-reading/03-06-SUMMARY.md`
</output>
