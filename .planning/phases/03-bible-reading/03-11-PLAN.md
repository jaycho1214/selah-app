---
phase: 03-bible-reading
plan: 11
type: fix
wave: 2
depends_on: ["03-10"]
files_modified:
  - app/(tabs)/index.tsx
  - app/(tabs)/_layout.tsx
  - components/bible/bible-navigator-bar.tsx
autonomous: true

must_haves:
  truths:
    - "Home tab shows Bible verses directly (not cards linking elsewhere)"
    - "Bible navigator appears above the bottom tab bar"
    - "Design matches selah-web: sticky navigator at top, verses below"
    - "Swipe navigation works on home tab"
  artifacts:
    - path: "app/(tabs)/index.tsx"
      provides: "Home tab with embedded BibleReader"
    - path: "components/bible/bible-navigator-bar.tsx"
      provides: "Compact navigator bar for tab screen"
  key_links:
    - from: "app/(tabs)/index.tsx"
      to: "components/bible/bible-reader.tsx"
      via: "embeds BibleReader component"
      pattern: "BibleReader"
---

<objective>
Redesign home tab to match selah-web: show Bible verses directly with navigator.

Purpose: User expects the same design as web app where the home page shows Bible verses immediately with a sticky navigator, not a hub with cards linking to other screens.

Output: Home tab displays BibleReader with navigator positioned above tab bar.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-bible-reading/03-UAT.md
Reference: /Users/jay/Codes/selah/selah-web/src/app/page.tsx - web shows BibleReadingPage directly
Reference: /Users/jay/Codes/selah/selah-web/src/client-pages/bible-reading-page.tsx - structure
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create compact BibleNavigatorBar component</name>
  <files>components/bible/bible-navigator-bar.tsx</files>
  <action>
Create `components/bible/bible-navigator-bar.tsx` - a compact horizontal navigator bar that sits above content:

```typescript
import { View, Pressable } from 'react-native';
import { ChevronLeft, ChevronRight, ChevronDown } from 'lucide-react-native';
import { Text } from '@/components/ui/text';
import { useBibleStore } from '@/lib/stores/bible-store';
import { BIBLE_BOOK_DETAILS, BIBLE_BOOKS } from '@/lib/bible/constants';
import { BibleBook } from '@/lib/bible/types';

interface BibleNavigatorBarProps {
  onOpenNavigator: () => void;
  onPrevChapter: () => void;
  onNextChapter: () => void;
}

export function BibleNavigatorBar({
  onOpenNavigator,
  onPrevChapter,
  onNextChapter,
}: BibleNavigatorBarProps) {
  const { currentBook, currentChapter, currentTranslation } = useBibleStore();

  const bookDetails = BIBLE_BOOK_DETAILS[currentBook as BibleBook];
  const bookName = bookDetails?.name ?? currentBook;

  // Check if at boundaries
  const bookIndex = BIBLE_BOOKS.indexOf(currentBook as BibleBook);
  const isFirstChapter = bookIndex === 0 && currentChapter === 1;
  const isLastChapter = bookIndex === BIBLE_BOOKS.length - 1 &&
    currentChapter === bookDetails?.chapters;

  return (
    <View className="flex-row items-center justify-between px-4 py-3 bg-background border-b border-border">
      {/* Previous Chapter */}
      <Pressable
        onPress={onPrevChapter}
        disabled={isFirstChapter}
        className={`p-2 rounded-lg ${isFirstChapter ? 'opacity-30' : 'active:bg-muted'}`}
      >
        <ChevronLeft size={24} className="text-foreground" />
      </Pressable>

      {/* Current Position - Tap to open navigator */}
      <Pressable
        onPress={onOpenNavigator}
        className="flex-row items-center gap-1 px-3 py-2 rounded-lg active:bg-muted"
      >
        <View className="items-center">
          <Text className="text-foreground text-lg font-semibold">
            {bookName} {currentChapter}
          </Text>
          <Text className="text-muted-foreground text-xs">
            {currentTranslation}
          </Text>
        </View>
        <ChevronDown size={16} className="text-muted-foreground" />
      </Pressable>

      {/* Next Chapter */}
      <Pressable
        onPress={onNextChapter}
        disabled={isLastChapter}
        className={`p-2 rounded-lg ${isLastChapter ? 'opacity-30' : 'active:bg-muted'}`}
      >
        <ChevronRight size={24} className="text-foreground" />
      </Pressable>
    </View>
  );
}
```

This provides:
- Left/right arrows for quick chapter navigation
- Center shows current book/chapter/translation
- Tapping center opens the full book/chapter navigator modal
  </action>
  <verify>
- File exports `BibleNavigatorBar` component
- Shows current book, chapter, translation
- Prev/next buttons with boundary checking
- TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Compact navigator bar for home tab</done>
</task>

<task type="auto">
  <name>Task 2: Redesign home tab to show Bible verses directly</name>
  <files>app/(tabs)/index.tsx</files>
  <action>
Replace `app/(tabs)/index.tsx` to embed the Bible reader directly:

```typescript
import { useState, useCallback, useRef } from 'react';
import { View } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
import { BibleReader } from '@/components/bible/bible-reader';
import { BibleNavigator } from '@/components/bible/bible-navigator';
import { BibleNavigatorBar } from '@/components/bible/bible-navigator-bar';
import { VerseActions, VerseActionsRef } from '@/components/bible/verse-actions';
import { NoteEditor, NoteEditorRef } from '@/components/bible/note-editor';
import { useBibleStore } from '@/lib/stores/bible-store';
import { BIBLE_BOOK_DETAILS, BIBLE_BOOKS } from '@/lib/bible/constants';
import type { BibleBook } from '@/lib/bible/types';

export default function HomeScreen() {
  const { currentBook, currentChapter, setPosition } = useBibleStore();
  const [navigatorVisible, setNavigatorVisible] = useState(false);
  const verseActionsRef = useRef<VerseActionsRef>(null);
  const noteEditorRef = useRef<NoteEditorRef>(null);

  // Key to force BibleReader remount on position change
  const [readerKey, setReaderKey] = useState(0);

  const handlePositionChange = useCallback(
    (book: BibleBook, chapter: number) => {
      setPosition(book, chapter);
    },
    [setPosition]
  );

  const handleNavigatorSelect = useCallback(
    (book: BibleBook, chapter: number) => {
      setPosition(book, chapter);
      setNavigatorVisible(false);
      setReaderKey((k) => k + 1); // Force remount
    },
    [setPosition]
  );

  const handlePrevChapter = useCallback(() => {
    const bookIndex = BIBLE_BOOKS.indexOf(currentBook as BibleBook);
    const bookDetails = BIBLE_BOOK_DETAILS[currentBook as BibleBook];

    if (currentChapter > 1) {
      setPosition(currentBook as BibleBook, currentChapter - 1);
    } else if (bookIndex > 0) {
      const prevBook = BIBLE_BOOKS[bookIndex - 1];
      const prevBookChapters = BIBLE_BOOK_DETAILS[prevBook].chapters;
      setPosition(prevBook, prevBookChapters);
    }
    setReaderKey((k) => k + 1);
  }, [currentBook, currentChapter, setPosition]);

  const handleNextChapter = useCallback(() => {
    const bookIndex = BIBLE_BOOKS.indexOf(currentBook as BibleBook);
    const bookDetails = BIBLE_BOOK_DETAILS[currentBook as BibleBook];

    if (currentChapter < bookDetails.chapters) {
      setPosition(currentBook as BibleBook, currentChapter + 1);
    } else if (bookIndex < BIBLE_BOOKS.length - 1) {
      const nextBook = BIBLE_BOOKS[bookIndex + 1];
      setPosition(nextBook, 1);
    }
    setReaderKey((k) => k + 1);
  }, [currentBook, currentChapter, setPosition]);

  const handleVersePress = useCallback((verseId: string, verseText?: string) => {
    verseActionsRef.current?.open(verseId, verseText ?? '');
  }, []);

  const handleNotePress = useCallback((verseId: string, verseText: string) => {
    verseActionsRef.current?.close();
    noteEditorRef.current?.open(verseId, verseText);
  }, []);

  return (
    <SafeAreaView className="flex-1 bg-background" edges={['top']}>
      {/* Navigator bar at top */}
      <BibleNavigatorBar
        onOpenNavigator={() => setNavigatorVisible(true)}
        onPrevChapter={handlePrevChapter}
        onNextChapter={handleNextChapter}
      />

      {/* Bible reader fills remaining space */}
      <View className="flex-1">
        <BibleReader
          key={readerKey}
          initialBook={currentBook as BibleBook}
          initialChapter={currentChapter}
          onPositionChange={handlePositionChange}
          onVersePress={handleVersePress}
          onVerseLongPress={handleVersePress}
        />
      </View>

      {/* Book/chapter picker modal */}
      <BibleNavigator
        currentBook={currentBook as BibleBook}
        currentChapter={currentChapter}
        onSelect={handleNavigatorSelect}
        visible={navigatorVisible}
        onClose={() => setNavigatorVisible(false)}
      />

      {/* Verse actions bottom sheet */}
      <VerseActions
        ref={verseActionsRef}
        onNote={handleNotePress}
      />

      {/* Note editor modal */}
      <NoteEditor ref={noteEditorRef} />
    </SafeAreaView>
  );
}
```

This matches the web app structure:
- Navigator bar sticky at top (like web's sticky BibleNavigator)
- Bible verses fill the screen (like web's BibleVerseList)
- Swipe navigation works via BibleReader's PagerView
  </action>
  <verify>
- Home tab shows Bible verses directly (no cards)
- Navigator bar at top with prev/next/open controls
- Tapping verse opens VerseActions
- Swipe navigation works
- TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Home tab redesigned to match web layout</done>
</task>

<task type="auto">
  <name>Task 3: Move utility links to profile tab</name>
  <files>app/(tabs)/profile.tsx</files>
  <action>
The Search, Bookmarks, and Notes links need a new home. Add them to the profile tab:

Read current profile.tsx and add a section for Bible utilities:

```typescript
// Add to profile screen, after user info section:

{/* Bible Utilities */}
<View className="mt-6">
  <Text className="text-muted-foreground text-sm font-medium px-4 mb-2">
    Bible
  </Text>

  <Pressable
    onPress={() => router.push('/search')}
    className="flex-row items-center justify-between px-4 py-3 bg-card border-y border-border active:opacity-70"
  >
    <View className="flex-row items-center gap-3">
      <Search size={20} className="text-muted-foreground" />
      <Text className="text-foreground text-base">Search Bible</Text>
    </View>
    <ChevronRight size={20} className="text-muted-foreground" />
  </Pressable>

  <Pressable
    onPress={() => router.push('/bookmarks')}
    className="flex-row items-center justify-between px-4 py-3 bg-card border-b border-border active:opacity-70"
  >
    <View className="flex-row items-center gap-3">
      <Bookmark size={20} className="text-muted-foreground" />
      <Text className="text-foreground text-base">Bookmarks</Text>
    </View>
    <View className="flex-row items-center gap-2">
      <Text className="text-muted-foreground">{Object.keys(bookmarks).length}</Text>
      <ChevronRight size={20} className="text-muted-foreground" />
    </View>
  </Pressable>

  <Pressable
    onPress={() => router.push('/notes')}
    className="flex-row items-center justify-between px-4 py-3 bg-card border-b border-border active:opacity-70"
  >
    <View className="flex-row items-center gap-3">
      <FileText size={20} className="text-muted-foreground" />
      <Text className="text-foreground text-base">Notes</Text>
    </View>
    <View className="flex-row items-center gap-2">
      <Text className="text-muted-foreground">{Object.keys(notes).length}</Text>
      <ChevronRight size={20} className="text-muted-foreground" />
    </View>
  </Pressable>
</View>
```

Add required imports:
```typescript
import { Search, Bookmark, FileText, ChevronRight } from 'lucide-react-native';
import { useAnnotationsStore } from '@/lib/stores/annotations-store';

// In component:
const { bookmarks, notes } = useAnnotationsStore();
```
  </action>
  <verify>
- Profile tab has Search, Bookmarks, Notes links
- Links navigate to correct screens
- Counts display for bookmarks and notes
- TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Utility links moved to profile tab</done>
</task>

</tasks>

<verification>
1. TypeScript check: `npx tsc --noEmit` - no errors
2. Launch app: Home tab shows Bible verses immediately
3. Navigator: Tap center to open book/chapter picker
4. Navigation: Tap arrows to go prev/next chapter
5. Swipe: Swipe left/right works on home tab
6. Profile: Search, Bookmarks, Notes accessible from profile tab
7. Verse actions: Tap verse to highlight/bookmark/note
</verification>

<success_criteria>
- Home tab displays Bible verses directly (matches web design)
- Navigator bar above content with prev/next/picker
- Swipe navigation between chapters works
- Verse interactions (tap, highlight, bookmark, note) work
- Search, Bookmarks, Notes accessible from profile tab
- No "Continue Reading" card on home
</success_criteria>

<output>
After completion, create `.planning/phases/03-bible-reading/03-11-SUMMARY.md`
</output>
