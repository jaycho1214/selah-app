---
phase: 03-bible-reading
plan: 04
type: execute
wave: 3
depends_on: ["03-03"]
files_modified:
  - components/bible/bible-reader.tsx
  - components/bible/bible-navigator.tsx
  - app/bible/_layout.tsx
  - app/bible/[book]/[chapter].tsx
  - app/(tabs)/index.tsx
autonomous: true

must_haves:
  truths:
    - "User can swipe left/right to change chapters"
    - "User can select book and chapter from navigator"
    - "Current position updates URL and persists to store"
    - "Bible reader accessible from home tab"
  artifacts:
    - path: "components/bible/bible-reader.tsx"
      provides: "PagerView with chapter navigation"
      exports: ["BibleReader"]
    - path: "components/bible/bible-navigator.tsx"
      provides: "Book and chapter picker"
      exports: ["BibleNavigator"]
    - path: "app/bible/[book]/[chapter].tsx"
      provides: "Dynamic route for Bible reading"
  key_links:
    - from: "components/bible/bible-reader.tsx"
      to: "react-native-pager-view"
      via: "PagerView component"
      pattern: "PagerView"
    - from: "app/bible/[book]/[chapter].tsx"
      to: "components/bible/bible-reader.tsx"
      via: "imports BibleReader"
      pattern: "BibleReader"
    - from: "components/bible/bible-reader.tsx"
      to: "lib/stores/bible-store.ts"
      via: "useBibleStore for position"
      pattern: "useBibleStore"
---

<objective>
Create Bible reader with swipe navigation and book/chapter picker.

Purpose: Users expect to swipe between chapters like turning pages. The PagerView provides native 60fps performance. The navigator allows jumping to any book/chapter.

Output: BibleReader with PagerView, BibleNavigator picker, and Expo Router integration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-bible-reading/03-RESEARCH.md
@.planning/phases/03-bible-reading/03-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install PagerView</name>
  <files>package.json</files>
  <action>
Install react-native-pager-view:
```bash
npx expo install react-native-pager-view
```

PagerView v7.x uses native ViewPager on Android and UIPageViewController on iOS for 60fps swipe navigation. It requires native modules, so a rebuild may be needed after installation.
  </action>
  <verify>
- `npm ls react-native-pager-view` shows package installed (v7.x)
  </verify>
  <done>PagerView installed for native swipe navigation</done>
</task>

<task type="auto">
  <name>Task 2: Create BibleReader with PagerView</name>
  <files>components/bible/bible-reader.tsx</files>
  <action>
Create `components/bible/bible-reader.tsx`:

```typescript
import { useRef, useCallback, useState, Suspense } from 'react';
import { View, ActivityIndicator } from 'react-native';
import PagerView from 'react-native-pager-view';
import { ChapterView } from './chapter-view';
import { useBibleStore } from '@/lib/stores/bible-store';
import { BIBLE_BOOKS, BIBLE_BOOK_DETAILS } from '@/lib/bible/constants';
import type { BibleBook } from '@/lib/bible/types';

interface BibleReaderProps {
  initialBook: BibleBook;
  initialChapter: number;
  onPositionChange?: (book: BibleBook, chapter: number) => void;
  onVersePress?: (verseId: string) => void;
  onVerseLongPress?: (verseId: string) => void;
}

export function BibleReader({
  initialBook,
  initialChapter,
  onPositionChange,
  onVersePress,
  onVerseLongPress,
}: BibleReaderProps) {
  const pagerRef = useRef<PagerView>(null);
  const { setPosition } = useBibleStore();

  // Track current position
  const [currentBook, setCurrentBook] = useState(initialBook);
  const [currentChapter, setCurrentChapter] = useState(initialChapter);

  const maxChapters = BIBLE_BOOK_DETAILS[currentBook].chapters;
  const bookIndex = BIBLE_BOOKS.indexOf(currentBook);

  // Calculate prev/next for 3-page pager
  const getPrevChapter = (): { book: BibleBook; chapter: number } | null => {
    if (currentChapter > 1) {
      return { book: currentBook, chapter: currentChapter - 1 };
    }
    // Go to previous book's last chapter
    if (bookIndex > 0) {
      const prevBook = BIBLE_BOOKS[bookIndex - 1];
      return { book: prevBook, chapter: BIBLE_BOOK_DETAILS[prevBook].chapters };
    }
    return null; // At Genesis 1
  };

  const getNextChapter = (): { book: BibleBook; chapter: number } | null => {
    if (currentChapter < maxChapters) {
      return { book: currentBook, chapter: currentChapter + 1 };
    }
    // Go to next book's first chapter
    if (bookIndex < BIBLE_BOOKS.length - 1) {
      const nextBook = BIBLE_BOOKS[bookIndex + 1];
      return { book: nextBook, chapter: 1 };
    }
    return null; // At Revelation 22
  };

  const prev = getPrevChapter();
  const next = getNextChapter();

  const handlePageSelected = useCallback(
    (e: { nativeEvent: { position: number } }) => {
      const position = e.nativeEvent.position;

      if (position === 0 && prev) {
        // Swiped to previous chapter
        setCurrentBook(prev.book);
        setCurrentChapter(prev.chapter);
        setPosition(prev.book, prev.chapter);
        onPositionChange?.(prev.book, prev.chapter);
        // Reset pager to middle
        pagerRef.current?.setPageWithoutAnimation(1);
      } else if (position === 2 && next) {
        // Swiped to next chapter
        setCurrentBook(next.book);
        setCurrentChapter(next.chapter);
        setPosition(next.book, next.chapter);
        onPositionChange?.(next.book, next.chapter);
        // Reset pager to middle
        pagerRef.current?.setPageWithoutAnimation(1);
      }
    },
    [prev, next, setPosition, onPositionChange]
  );

  // Navigate to specific position (called from navigator)
  const navigateTo = useCallback(
    (book: BibleBook, chapter: number) => {
      setCurrentBook(book);
      setCurrentChapter(chapter);
      setPosition(book, chapter);
      onPositionChange?.(book, chapter);
    },
    [setPosition, onPositionChange]
  );

  const ChapterFallback = () => (
    <View className="flex-1 items-center justify-center">
      <ActivityIndicator size="large" />
    </View>
  );

  return (
    <PagerView
      ref={pagerRef}
      style={{ flex: 1 }}
      initialPage={1}
      onPageSelected={handlePageSelected}
      offscreenPageLimit={1}
    >
      {/* Page 0: Previous chapter */}
      <View key="prev" style={{ flex: 1 }}>
        {prev ? (
          <Suspense fallback={<ChapterFallback />}>
            <ChapterView
              book={prev.book}
              chapter={prev.chapter}
              onVersePress={onVersePress}
              onVerseLongPress={onVerseLongPress}
            />
          </Suspense>
        ) : (
          <View className="flex-1" />
        )}
      </View>

      {/* Page 1: Current chapter */}
      <View key="current" style={{ flex: 1 }}>
        <Suspense fallback={<ChapterFallback />}>
          <ChapterView
            book={currentBook}
            chapter={currentChapter}
            onVersePress={onVersePress}
            onVerseLongPress={onVerseLongPress}
          />
        </Suspense>
      </View>

      {/* Page 2: Next chapter */}
      <View key="next" style={{ flex: 1 }}>
        {next ? (
          <Suspense fallback={<ChapterFallback />}>
            <ChapterView
              book={next.book}
              chapter={next.chapter}
              onVersePress={onVersePress}
              onVerseLongPress={onVerseLongPress}
            />
          </Suspense>
        ) : (
          <View className="flex-1" />
        )}
      </View>
    </PagerView>
  );
}
```

The 3-page pattern keeps memory low: only prev, current, next chapters are rendered. When user swipes, the pager resets to middle and updates which chapters are in each position.

Export `navigateTo` via a ref or provide it through context if needed for the navigator.
  </action>
  <verify>
- File exports `BibleReader` component
- Uses PagerView with 3 pages (prev, current, next)
- Handles book boundaries (Genesis 1 has no prev, Revelation 22 has no next)
- Updates bible store on navigation
- TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>BibleReader component provides swipe navigation between chapters</done>
</task>

<task type="auto">
  <name>Task 3: Create BibleNavigator and route structure</name>
  <files>components/bible/bible-navigator.tsx, app/bible/_layout.tsx, app/bible/[book]/[chapter].tsx, app/(tabs)/index.tsx</files>
  <action>
Create `components/bible/bible-navigator.tsx`:

```typescript
import { useState, useMemo } from 'react';
import { View, Text, Pressable, ScrollView, Modal } from 'react-native';
import { BIBLE_BOOKS, BIBLE_BOOK_DETAILS } from '@/lib/bible/constants';
import type { BibleBook } from '@/lib/bible/types';

interface BibleNavigatorProps {
  currentBook: BibleBook;
  currentChapter: number;
  onSelect: (book: BibleBook, chapter: number) => void;
  visible: boolean;
  onClose: () => void;
}

export function BibleNavigator({
  currentBook,
  currentChapter,
  onSelect,
  visible,
  onClose,
}: BibleNavigatorProps) {
  const [selectedBook, setSelectedBook] = useState<BibleBook | null>(null);

  const bookDetails = useMemo(
    () => (selectedBook ? BIBLE_BOOK_DETAILS[selectedBook] : null),
    [selectedBook]
  );

  const handleBookSelect = (book: BibleBook) => {
    setSelectedBook(book);
  };

  const handleChapterSelect = (chapter: number) => {
    if (selectedBook) {
      onSelect(selectedBook, chapter);
      setSelectedBook(null);
      onClose();
    }
  };

  const handleClose = () => {
    setSelectedBook(null);
    onClose();
  };

  return (
    <Modal
      visible={visible}
      animationType="slide"
      presentationStyle="pageSheet"
      onRequestClose={handleClose}
    >
      <View className="flex-1 bg-background">
        {/* Header */}
        <View className="flex-row items-center justify-between px-4 py-3 border-b border-border">
          <Pressable onPress={handleClose} className="p-2">
            <Text className="text-primary text-base">Cancel</Text>
          </Pressable>
          <Text className="text-foreground text-lg font-semibold">
            {selectedBook ? BIBLE_BOOK_DETAILS[selectedBook].name : 'Select Book'}
          </Text>
          <View className="w-16" />
        </View>

        {/* Content */}
        {selectedBook && bookDetails ? (
          // Chapter grid
          <ScrollView className="flex-1 p-4">
            <View className="flex-row flex-wrap gap-2">
              {Array.from({ length: bookDetails.chapters }, (_, i) => i + 1).map(
                (chapter) => (
                  <Pressable
                    key={chapter}
                    onPress={() => handleChapterSelect(chapter)}
                    className={`w-12 h-12 items-center justify-center rounded-lg ${
                      selectedBook === currentBook && chapter === currentChapter
                        ? 'bg-primary'
                        : 'bg-muted'
                    }`}
                  >
                    <Text
                      className={`text-base font-medium ${
                        selectedBook === currentBook && chapter === currentChapter
                          ? 'text-primary-foreground'
                          : 'text-foreground'
                      }`}
                    >
                      {chapter}
                    </Text>
                  </Pressable>
                )
              )}
            </View>
          </ScrollView>
        ) : (
          // Book list
          <ScrollView className="flex-1">
            {/* Old Testament */}
            <View className="px-4 py-2 bg-muted">
              <Text className="text-sm font-semibold text-muted-foreground">
                Old Testament
              </Text>
            </View>
            {BIBLE_BOOKS.filter(
              (book) => BIBLE_BOOK_DETAILS[book].testament === 'old'
            ).map((book) => (
              <Pressable
                key={book}
                onPress={() => handleBookSelect(book)}
                className={`px-4 py-3 border-b border-border ${
                  book === currentBook ? 'bg-primary/10' : ''
                }`}
              >
                <Text className="text-foreground text-base">
                  {BIBLE_BOOK_DETAILS[book].name}
                </Text>
              </Pressable>
            ))}

            {/* New Testament */}
            <View className="px-4 py-2 bg-muted">
              <Text className="text-sm font-semibold text-muted-foreground">
                New Testament
              </Text>
            </View>
            {BIBLE_BOOKS.filter(
              (book) => BIBLE_BOOK_DETAILS[book].testament === 'new'
            ).map((book) => (
              <Pressable
                key={book}
                onPress={() => handleBookSelect(book)}
                className={`px-4 py-3 border-b border-border ${
                  book === currentBook ? 'bg-primary/10' : ''
                }`}
              >
                <Text className="text-foreground text-base">
                  {BIBLE_BOOK_DETAILS[book].name}
                </Text>
              </Pressable>
            ))}
          </ScrollView>
        )}
      </View>
    </Modal>
  );
}
```

Create `app/bible/_layout.tsx`:

```typescript
import { Stack } from 'expo-router';

export default function BibleLayout() {
  return (
    <Stack screenOptions={{ headerShown: false }}>
      <Stack.Screen name="[book]/[chapter]" />
    </Stack>
  );
}
```

Create `app/bible/[book]/[chapter].tsx`:

```typescript
import { useState, useCallback } from 'react';
import { View, Text, Pressable } from 'react-native';
import { useLocalSearchParams, router, Stack } from 'expo-router';
import { SafeAreaView } from 'react-native-safe-area-context';
import { BibleReader } from '@/components/bible/bible-reader';
import { BibleNavigator } from '@/components/bible/bible-navigator';
import { BIBLE_BOOK_DETAILS } from '@/lib/bible/constants';
import { useBibleStore } from '@/lib/stores/bible-store';
import type { BibleBook } from '@/lib/bible/types';

export default function BibleChapterScreen() {
  const { book, chapter } = useLocalSearchParams<{ book: string; chapter: string }>();
  const { currentTranslation } = useBibleStore();
  const [navigatorVisible, setNavigatorVisible] = useState(false);

  const currentBook = book as BibleBook;
  const currentChapter = parseInt(chapter, 10);
  const bookName = BIBLE_BOOK_DETAILS[currentBook]?.name ?? book;

  const handlePositionChange = useCallback(
    (newBook: BibleBook, newChapter: number) => {
      router.setParams({ book: newBook, chapter: String(newChapter) });
    },
    []
  );

  const handleNavigatorSelect = useCallback(
    (selectedBook: BibleBook, selectedChapter: number) => {
      router.setParams({ book: selectedBook, chapter: String(selectedChapter) });
    },
    []
  );

  const handleVersePress = useCallback((verseId: string) => {
    // TODO: Show verse actions (highlight, bookmark, note, share)
    console.log('Verse pressed:', verseId);
  }, []);

  const handleVerseLongPress = useCallback((verseId: string) => {
    // TODO: Show verse actions sheet
    console.log('Verse long-pressed:', verseId);
  }, []);

  return (
    <SafeAreaView className="flex-1 bg-background" edges={['top']}>
      <Stack.Screen
        options={{
          headerShown: true,
          headerTitle: () => (
            <Pressable onPress={() => setNavigatorVisible(true)}>
              <View className="items-center">
                <Text className="text-foreground text-lg font-semibold">
                  {bookName} {currentChapter}
                </Text>
                <Text className="text-muted-foreground text-xs">
                  {currentTranslation}
                </Text>
              </View>
            </Pressable>
          ),
        }}
      />

      <BibleReader
        initialBook={currentBook}
        initialChapter={currentChapter}
        onPositionChange={handlePositionChange}
        onVersePress={handleVersePress}
        onVerseLongPress={handleVerseLongPress}
      />

      <BibleNavigator
        currentBook={currentBook}
        currentChapter={currentChapter}
        onSelect={handleNavigatorSelect}
        visible={navigatorVisible}
        onClose={() => setNavigatorVisible(false)}
      />
    </SafeAreaView>
  );
}
```

Update `app/(tabs)/index.tsx` to navigate to Bible reader:

```typescript
import { useEffect } from 'react';
import { View, Text, Pressable } from 'react-native';
import { router } from 'expo-router';
import { useBibleStore } from '@/lib/stores/bible-store';
import { BIBLE_BOOK_DETAILS } from '@/lib/bible/constants';

export default function HomeScreen() {
  const { currentBook, currentChapter, currentTranslation } = useBibleStore();
  const bookName = BIBLE_BOOK_DETAILS[currentBook as keyof typeof BIBLE_BOOK_DETAILS]?.name ?? currentBook;

  const handleContinueReading = () => {
    router.push(`/bible/${currentBook}/${currentChapter}`);
  };

  return (
    <View className="flex-1 bg-background p-4">
      <Text className="text-foreground text-2xl font-bold mb-6">Selah</Text>

      {/* Continue Reading Card */}
      <Pressable
        onPress={handleContinueReading}
        className="bg-card rounded-xl p-4 shadow-sm border border-border"
      >
        <Text className="text-muted-foreground text-sm mb-1">Continue Reading</Text>
        <Text className="text-foreground text-xl font-semibold">
          {bookName} {currentChapter}
        </Text>
        <Text className="text-muted-foreground text-sm">{currentTranslation}</Text>
      </Pressable>
    </View>
  );
}
```
  </action>
  <verify>
- BibleNavigator shows book list with Old/New Testament sections
- BibleNavigator shows chapter grid when book selected
- Route `/bible/GENESIS/1` renders BibleReader
- Header shows book name, chapter, tappable for navigator
- Home tab shows "Continue Reading" card with last position
- TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Bible navigation complete with swipe, picker, and routing</done>
</task>

</tasks>

<verification>
1. TypeScript check: `npx tsc --noEmit` - no errors
2. App test: Start app, tap "Continue Reading" to open Bible reader
3. Swipe test: Swipe left/right to change chapters
4. Navigator test: Tap header, select different book/chapter
5. Position persistence: Close and reopen app, check position remembered
</verification>

<success_criteria>
- Swiping left/right navigates between chapters (BIBL-02)
- Book/chapter picker allows jumping to any location
- URL updates when position changes (`/bible/GENESIS/1`)
- Reading position persists to bible store
- Home tab shows current reading position
- Navigation handles book boundaries (Genesis 1, Revelation 22)
</success_criteria>

<output>
After completion, create `.planning/phases/03-bible-reading/03-04-SUMMARY.md`
</output>
