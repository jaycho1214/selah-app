---
phase: 01-foundation
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - components/rich-text/editor.tsx
  - components/rich-text/renderer.tsx
  - components/rich-text/index.ts
  - app/(tabs)/explore.tsx
autonomous: true

must_haves:
  truths:
    - "Rich text editor displays and allows text input"
    - "Editor toolbar shows formatting options (bold, italic, etc.)"
    - "Rich text renderer displays formatted HTML content"
    - "Proof-of-concept demonstrates both editing and reading capability"
  artifacts:
    - path: "components/rich-text/editor.tsx"
      provides: "10tap-editor wrapper component"
      exports: ["RichTextEditor"]
    - path: "components/rich-text/renderer.tsx"
      provides: "HTML content renderer"
      exports: ["RichTextRenderer"]
    - path: "components/rich-text/index.ts"
      provides: "Barrel export for rich text components"
  key_links:
    - from: "components/rich-text/editor.tsx"
      to: "@10play/tentap-editor"
      via: "useEditorBridge hook"
      pattern: "useEditorBridge"
    - from: "app/(tabs)/explore.tsx"
      to: "components/rich-text/editor.tsx"
      via: "POC demonstration"
      pattern: "<RichTextEditor"
---

<objective>
Create rich text editing and rendering proof-of-concept using 10tap-editor.

Purpose: Validate rich text strategy for verse posts and comments in later phases.
Output: Working rich text editor and renderer components demonstrating capability.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install 10tap-editor and dependencies</name>
  <files>
    package.json
  </files>
  <action>
    1. Install 10tap-editor and required dependencies:
       ```bash
       npx expo install @10play/tentap-editor react-native-webview
       ```

       Note: Using `npx expo install` ensures Expo-compatible versions.

    2. Verify installation by checking package.json includes:
       - @10play/tentap-editor
       - react-native-webview

    3. For iOS, ensure WebView works:
       - WebView should work in Expo Go for basic usage
       - Note: Full 10tap-editor features may require dev client build
       - For this POC, we'll test what works in Expo Go

    4. If iOS simulator needs pods:
       ```bash
       cd ios && pod install && cd ..
       ```
       (Only if bare workflow - Expo Go handles this automatically)
  </action>
  <verify>
    - package.json contains @10play/tentap-editor
    - package.json contains react-native-webview
    - `npx expo start` runs without dependency errors
  </verify>
  <done>
    10tap-editor and dependencies installed successfully.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create rich text editor component</name>
  <files>
    components/rich-text/editor.tsx
    components/rich-text/index.ts
  </files>
  <action>
    1. Create `components/rich-text/editor.tsx`:
       ```typescript
       import React from 'react';
       import { KeyboardAvoidingView, Platform, StyleSheet, View } from 'react-native';
       import { SafeAreaView } from 'react-native-safe-area-context';
       import {
         RichText,
         Toolbar,
         useEditorBridge,
         TenTapStartKit,
         CoreBridge,
       } from '@10play/tentap-editor';

       interface RichTextEditorProps {
         initialContent?: string;
         onContentChange?: (html: string) => void;
         placeholder?: string;
       }

       export function RichTextEditor({
         initialContent = '',
         onContentChange,
         placeholder = 'Start writing...',
       }: RichTextEditorProps) {
         const editor = useEditorBridge({
           autofocus: false,
           avoidIosKeyboard: true,
           initialContent: initialContent || `<p>${placeholder}</p>`,
           bridgeExtensions: [
             ...TenTapStartKit,
             CoreBridge.configureCSS(`
               body {
                 font-family: -apple-system, BlinkMacSystemFont, sans-serif;
                 font-size: 16px;
                 line-height: 1.5;
                 padding: 16px;
               }
             `),
           ],
           onChange: async () => {
             if (onContentChange) {
               const html = await editor.getHTML();
               onContentChange(html);
             }
           },
         });

         return (
           <View style={styles.container}>
             <RichText editor={editor} />
             <KeyboardAvoidingView
               behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
               style={styles.keyboardView}
             >
               <Toolbar editor={editor} />
             </KeyboardAvoidingView>
           </View>
         );
       }

       const styles = StyleSheet.create({
         container: {
           flex: 1,
           backgroundColor: '#fff',
         },
         keyboardView: {
           position: 'absolute',
           width: '100%',
           bottom: 0,
         },
       });
       ```

       Note: 10tap-editor uses WebView internally. Basic features should work in
       Expo Go, but advanced features may require a development build.

    2. Create `components/rich-text/index.ts`:
       ```typescript
       export { RichTextEditor } from './editor';
       export { RichTextRenderer } from './renderer';
       ```
  </action>
  <verify>
    - `components/rich-text/editor.tsx` exports RichTextEditor
    - Component compiles without TypeScript errors
    - Import works: `import { RichTextEditor } from '@/components/rich-text'`
  </verify>
  <done>
    RichTextEditor component created with 10tap-editor integration.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create rich text renderer and POC demo</name>
  <files>
    components/rich-text/renderer.tsx
    app/(tabs)/explore.tsx
  </files>
  <action>
    1. Create `components/rich-text/renderer.tsx` for displaying HTML content:
       ```typescript
       import React from 'react';
       import { View, StyleSheet, useWindowDimensions } from 'react-native';
       import { useRenderHTML } from '@10play/tentap-editor';

       interface RichTextRendererProps {
         html: string;
         className?: string;
       }

       export function RichTextRenderer({ html }: RichTextRendererProps) {
         const { width } = useWindowDimensions();

         // Use 10tap's built-in HTML rendering
         // This renders the same HTML that the editor produces
         const { renderedContent } = useRenderHTML({
           html,
           contentWidth: width - 32, // Account for padding
         });

         return <View style={styles.container}>{renderedContent}</View>;
       }

       const styles = StyleSheet.create({
         container: {
           padding: 16,
         },
       });
       ```

       ALTERNATIVE: If useRenderHTML doesn't work well, use a simpler approach
       with WebView or react-native-render-html:
       ```typescript
       import React from 'react';
       import { View, StyleSheet } from 'react-native';
       import WebView from 'react-native-webview';

       interface RichTextRendererProps {
         html: string;
       }

       export function RichTextRenderer({ html }: RichTextRendererProps) {
         const wrappedHtml = `
           <!DOCTYPE html>
           <html>
           <head>
             <meta name="viewport" content="width=device-width, initial-scale=1">
             <style>
               body {
                 font-family: -apple-system, BlinkMacSystemFont, sans-serif;
                 font-size: 16px;
                 line-height: 1.5;
                 padding: 16px;
                 margin: 0;
               }
             </style>
           </head>
           <body>${html}</body>
           </html>
         `;

         return (
           <View style={styles.container}>
             <WebView
               source={{ html: wrappedHtml }}
               style={styles.webview}
               scrollEnabled={false}
             />
           </View>
         );
       }

       const styles = StyleSheet.create({
         container: {
           minHeight: 100,
         },
         webview: {
           backgroundColor: 'transparent',
         },
       });
       ```

    2. Update `app/(tabs)/explore.tsx` with POC demonstration:
       ```typescript
       import React, { useState } from 'react';
       import { View, ScrollView, SafeAreaView } from 'react-native';
       import { Text } from '@/components/ui/text';
       import { Button } from '@/components/ui/button';
       import { Card, CardHeader, CardTitle, CardContent } from '@/components/ui/card';
       import { RichTextEditor, RichTextRenderer } from '@/components/rich-text';

       export default function ExploreScreen() {
         const [showEditor, setShowEditor] = useState(false);
         const [content, setContent] = useState('<p>Hello, <strong>world</strong>!</p>');

         if (showEditor) {
           return (
             <SafeAreaView className="flex-1 bg-background">
               <View className="flex-row justify-between items-center p-4 border-b border-border">
                 <Text className="text-lg font-semibold">Rich Text Editor</Text>
                 <Button variant="ghost" onPress={() => setShowEditor(false)}>
                   Done
                 </Button>
               </View>
               <RichTextEditor
                 initialContent={content}
                 onContentChange={setContent}
               />
             </SafeAreaView>
           );
         }

         return (
           <SafeAreaView className="flex-1 bg-background">
             <ScrollView className="flex-1 p-4">
               <Text className="text-2xl font-bold mb-4">Rich Text POC</Text>
               <Text className="text-muted-foreground mb-6">
                 Proof-of-concept for verse post creation
               </Text>

               <Card className="mb-4">
                 <CardHeader>
                   <CardTitle>Rendered Content</CardTitle>
                 </CardHeader>
                 <CardContent>
                   <RichTextRenderer html={content} />
                 </CardContent>
               </Card>

               <Button onPress={() => setShowEditor(true)}>
                 Edit Content
               </Button>

               <View className="mt-8 p-4 bg-muted rounded-lg">
                 <Text className="text-sm font-mono text-muted-foreground">
                   Raw HTML:
                 </Text>
                 <Text className="text-xs font-mono mt-2">
                   {content}
                 </Text>
               </View>
             </ScrollView>
           </SafeAreaView>
         );
       }
       ```

       This POC demonstrates:
       - Rich text editor with toolbar
       - HTML content rendering
       - State management for content
       - Integration with themed UI components

    3. If 10tap-editor has issues in Expo Go, add error boundary:
       ```typescript
       import { ErrorBoundary } from 'react-error-boundary';

       function EditorFallback() {
         return (
           <View className="p-4">
             <Text className="text-destructive">
               Rich text editor requires a development build.
               Using Expo Go may have limited functionality.
             </Text>
           </View>
         );
       }

       // Wrap RichTextEditor with ErrorBoundary in explore.tsx
       <ErrorBoundary FallbackComponent={EditorFallback}>
         <RichTextEditor ... />
       </ErrorBoundary>
       ```
  </action>
  <verify>
    - Navigate to Explore tab
    - See rendered content "Hello, world!" with "world" in bold
    - Tap "Edit Content" button
    - Editor opens with toolbar visible
    - Can type and format text
    - Tap "Done" to return to view
    - Content updates reflect in both render and raw HTML display
  </verify>
  <done>
    Rich text renderer and editor POC working on Explore tab.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Navigate to Explore tab
2. See formatted content rendered (bold text visible)
3. Tap "Edit Content" - editor opens
4. Editor toolbar shows formatting buttons
5. Can type text and apply formatting
6. Done button returns to view with updated content
7. Raw HTML section shows the markup
</verification>

<success_criteria>
- Rich text editor displays and allows text input
- Editor toolbar shows formatting options (bold, italic, etc.)
- Rich text renderer displays formatted HTML content
- Proof-of-concept demonstrates both editing and reading capability
- Components are reusable for Phase 6 (Verse Posts)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-05-SUMMARY.md`
</output>
