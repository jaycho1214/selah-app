---
phase: 01-foundation
plan: 04
type: execute
wave: 2
depends_on: ["01-03"]
files_modified:
  - global.css
  - tailwind.config.ts
  - lib/theme/colors.ts
  - components/providers/theme-provider.tsx
  - app/_layout.tsx
  - constants/theme.ts
autonomous: true

must_haves:
  truths:
    - "UI components render with OKLCH-derived colors matching selah-web"
    - "Dark mode applies different color scheme throughout app"
    - "Light mode applies different color scheme throughout app"
    - "Theme toggle correctly switches between dark and light modes"
    - "Colors persist based on system preference or user choice"
  artifacts:
    - path: "global.css"
      provides: "CSS variables with RGB values derived from selah-web OKLCH colors"
      contains: "--background"
    - path: "tailwind.config.ts"
      provides: "Tailwind theme with semantic color tokens"
      contains: "colors:"
    - path: "lib/theme/colors.ts"
      provides: "Color token documentation and reference"
      exports: ["COLORS"]
    - path: "components/providers/theme-provider.tsx"
      provides: "Theme context with toggle functionality"
      exports: ["ThemeProvider", "useTheme"]
  key_links:
    - from: "tailwind.config.ts"
      to: "global.css"
      via: "CSS variable references"
      pattern: "rgb\\(var\\(--"
    - from: "app/_layout.tsx"
      to: "components/providers/theme-provider.tsx"
      via: "ThemeProvider wrapper"
      pattern: "<ThemeProvider>"
---

<objective>
Implement theme system with OKLCH colors matching selah-web and dark/light mode toggle.

Purpose: Ensure visual consistency between web and mobile apps with proper theme support.
Output: Complete theme system with CSS variables, Tailwind integration, and theme toggle.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-03-SUMMARY.md
@global.css
@tailwind.config.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add theme CSS variables with OKLCH-to-RGB colors</name>
  <files>
    global.css
    lib/theme/colors.ts
  </files>
  <action>
    1. Create `lib/theme/colors.ts` to document the color mappings:
       ```typescript
       /**
        * OKLCH to RGB color mappings from selah-web
        *
        * These colors are converted from OKLCH to RGB for React Native compatibility.
        * Source: selah-web/src/app/globals.css
        *
        * Format: RGB values as space-separated numbers (e.g., "255 255 255")
        * Usage in CSS: rgb(var(--color-name) / <alpha>)
        */

       export const COLORS = {
         light: {
           // oklch(1 0 0) -> #ffffff
           background: '255 255 255',
           // oklch(0.13 0.028 261.692) -> ~#121218
           foreground: '18 18 24',
           // oklch(1 0 0) -> #ffffff
           card: '255 255 255',
           cardForeground: '18 18 24',
           // oklch(1 0 0) -> #ffffff
           popover: '255 255 255',
           popoverForeground: '18 18 24',
           // oklch(0.21 0.034 264.665) -> ~#212430
           primary: '33 36 48',
           // oklch(0.985 0.002 247.839) -> ~#fafafc
           primaryForeground: '250 250 252',
           // oklch(0.967 0.003 264.542) -> ~#f3f4f6
           secondary: '243 244 246',
           secondaryForeground: '33 36 48',
           // oklch(0.967 0.003 264.542) -> ~#f3f4f6
           muted: '243 244 246',
           // oklch(0.551 0.027 264.364) -> ~#717a8a
           mutedForeground: '113 122 138',
           // oklch(0.967 0.003 264.542) -> ~#f3f4f6
           accent: '243 244 246',
           accentForeground: '33 36 48',
           // oklch(0.577 0.245 27.325) -> ~#dc2626
           destructive: '220 38 38',
           destructiveForeground: '250 250 252',
           // oklch(0.928 0.006 264.531) -> ~#e4e8ee
           border: '228 232 238',
           input: '228 232 238',
           // oklch(0.707 0.022 261.325) -> ~#a0aab8
           ring: '160 170 184',
         },
         dark: {
           // oklch(0.13 0.028 261.692) -> ~#121218
           background: '18 18 24',
           // oklch(0.985 0.002 247.839) -> ~#fafafc
           foreground: '250 250 252',
           // oklch(0.21 0.034 264.665) -> ~#212430
           card: '33 36 48',
           cardForeground: '250 250 252',
           // oklch(0.21 0.034 264.665) -> ~#212430
           popover: '33 36 48',
           popoverForeground: '250 250 252',
           // oklch(0.928 0.006 264.531) -> ~#e4e8ee
           primary: '228 232 238',
           // oklch(0.21 0.034 264.665) -> ~#212430
           primaryForeground: '33 36 48',
           // oklch(0.278 0.033 256.848) -> ~#2e3442
           secondary: '46 52 66',
           secondaryForeground: '250 250 252',
           // oklch(0.278 0.033 256.848) -> ~#2e3442
           muted: '46 52 66',
           // oklch(0.707 0.022 261.325) -> ~#a0aab8
           mutedForeground: '160 170 184',
           // oklch(0.278 0.033 256.848) -> ~#2e3442
           accent: '46 52 66',
           accentForeground: '250 250 252',
           // oklch(0.704 0.191 22.216) -> ~#f87171
           destructive: '248 113 113',
           destructiveForeground: '18 18 24',
           // oklch(1 0 0 / 10%) -> rgba(255,255,255,0.1)
           border: '255 255 255',
           input: '255 255 255',
           // oklch(0.707 0.022 261.325) -> ~#a0aab8
           ring: '160 170 184',
         },
       } as const;

       export type ColorScheme = 'light' | 'dark';
       export type ColorToken = keyof typeof COLORS.light;
       ```

    2. Update `global.css` with full theme variables:
       ```css
       @tailwind base;
       @tailwind components;
       @tailwind utilities;

       :root {
         --background: 255 255 255;
         --foreground: 18 18 24;
         --card: 255 255 255;
         --card-foreground: 18 18 24;
         --popover: 255 255 255;
         --popover-foreground: 18 18 24;
         --primary: 33 36 48;
         --primary-foreground: 250 250 252;
         --secondary: 243 244 246;
         --secondary-foreground: 33 36 48;
         --muted: 243 244 246;
         --muted-foreground: 113 122 138;
         --accent: 243 244 246;
         --accent-foreground: 33 36 48;
         --destructive: 220 38 38;
         --destructive-foreground: 250 250 252;
         --border: 228 232 238;
         --input: 228 232 238;
         --ring: 160 170 184;
         --radius: 0.625rem;
       }

       .dark:root {
         --background: 18 18 24;
         --foreground: 250 250 252;
         --card: 33 36 48;
         --card-foreground: 250 250 252;
         --popover: 33 36 48;
         --popover-foreground: 250 250 252;
         --primary: 228 232 238;
         --primary-foreground: 33 36 48;
         --secondary: 46 52 66;
         --secondary-foreground: 250 250 252;
         --muted: 46 52 66;
         --muted-foreground: 160 170 184;
         --accent: 46 52 66;
         --accent-foreground: 250 250 252;
         --destructive: 248 113 113;
         --destructive-foreground: 18 18 24;
         --border: 255 255 255 / 0.1;
         --input: 255 255 255 / 0.15;
         --ring: 160 170 184;
       }
       ```

       IMPORTANT: Use `.dark:root` NOT just `.dark` for NativeWind compatibility.
  </action>
  <verify>
    - `lib/theme/colors.ts` exports COLORS object
    - `global.css` contains :root and .dark:root sections
    - All color variables are defined in both light and dark modes
  </verify>
  <done>
    CSS variables defined with RGB values derived from selah-web OKLCH colors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Tailwind config with semantic colors</name>
  <files>
    tailwind.config.ts
  </files>
  <action>
    Update `tailwind.config.ts` to use CSS variable-based colors:

    ```typescript
    import type { Config } from 'tailwindcss';

    export default {
      darkMode: 'class',
      content: [
        './app/**/*.{js,jsx,ts,tsx}',
        './components/**/*.{js,jsx,ts,tsx}',
      ],
      presets: [require('nativewind/preset')],
      theme: {
        extend: {
          colors: {
            background: 'rgb(var(--background) / <alpha-value>)',
            foreground: 'rgb(var(--foreground) / <alpha-value>)',
            card: {
              DEFAULT: 'rgb(var(--card) / <alpha-value>)',
              foreground: 'rgb(var(--card-foreground) / <alpha-value>)',
            },
            popover: {
              DEFAULT: 'rgb(var(--popover) / <alpha-value>)',
              foreground: 'rgb(var(--popover-foreground) / <alpha-value>)',
            },
            primary: {
              DEFAULT: 'rgb(var(--primary) / <alpha-value>)',
              foreground: 'rgb(var(--primary-foreground) / <alpha-value>)',
            },
            secondary: {
              DEFAULT: 'rgb(var(--secondary) / <alpha-value>)',
              foreground: 'rgb(var(--secondary-foreground) / <alpha-value>)',
            },
            muted: {
              DEFAULT: 'rgb(var(--muted) / <alpha-value>)',
              foreground: 'rgb(var(--muted-foreground) / <alpha-value>)',
            },
            accent: {
              DEFAULT: 'rgb(var(--accent) / <alpha-value>)',
              foreground: 'rgb(var(--accent-foreground) / <alpha-value>)',
            },
            destructive: {
              DEFAULT: 'rgb(var(--destructive) / <alpha-value>)',
              foreground: 'rgb(var(--destructive-foreground) / <alpha-value>)',
            },
            border: 'rgb(var(--border) / <alpha-value>)',
            input: 'rgb(var(--input) / <alpha-value>)',
            ring: 'rgb(var(--ring) / <alpha-value>)',
          },
          borderRadius: {
            lg: 'var(--radius)',
            md: 'calc(var(--radius) - 2px)',
            sm: 'calc(var(--radius) - 4px)',
          },
        },
      },
      plugins: [],
    } satisfies Config;
    ```

    This enables usage like:
    - `bg-background` - theme-aware background
    - `text-foreground` - theme-aware text
    - `bg-primary text-primary-foreground` - button styling
    - `border-border` - theme-aware borders
  </action>
  <verify>
    - Config uses CSS variable syntax correctly
    - darkMode is set to 'class'
    - All semantic color tokens are defined
  </verify>
  <done>
    Tailwind config maps semantic colors to CSS variables.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create theme provider with toggle functionality</name>
  <files>
    components/providers/theme-provider.tsx
    app/_layout.tsx
    constants/theme.ts
  </files>
  <action>
    1. Update `constants/theme.ts` with navigation theme colors:
       ```typescript
       import type { Theme } from '@react-navigation/native';

       export const NAV_THEME = {
         light: {
           dark: false,
           colors: {
             background: 'rgb(255, 255, 255)', // --background
             border: 'rgb(228, 232, 238)',      // --border
             card: 'rgb(255, 255, 255)',        // --card
             notification: 'rgb(220, 38, 38)',  // --destructive
             primary: 'rgb(33, 36, 48)',        // --primary
             text: 'rgb(18, 18, 24)',           // --foreground
           },
         } satisfies Theme,
         dark: {
           dark: true,
           colors: {
             background: 'rgb(18, 18, 24)',     // --background
             border: 'rgba(255, 255, 255, 0.1)', // --border
             card: 'rgb(33, 36, 48)',           // --card
             notification: 'rgb(248, 113, 113)', // --destructive
             primary: 'rgb(228, 232, 238)',     // --primary
             text: 'rgb(250, 250, 252)',        // --foreground
           },
         } satisfies Theme,
       };
       ```

    2. Create `components/providers/theme-provider.tsx`:
       ```typescript
       import { createContext, useContext, useEffect, useState, ReactNode } from 'react';
       import { useColorScheme as useNativeWindColorScheme } from 'nativewind';
       import { useColorScheme as useRNColorScheme } from 'react-native';

       type Theme = 'light' | 'dark' | 'system';

       interface ThemeContextValue {
         theme: Theme;
         resolvedTheme: 'light' | 'dark';
         setTheme: (theme: Theme) => void;
         toggleTheme: () => void;
       }

       const ThemeContext = createContext<ThemeContextValue | undefined>(undefined);

       interface ThemeProviderProps {
         children: ReactNode;
         defaultTheme?: Theme;
       }

       export function ThemeProvider({ children, defaultTheme = 'system' }: ThemeProviderProps) {
         const systemColorScheme = useRNColorScheme();
         const { setColorScheme } = useNativeWindColorScheme();
         const [theme, setThemeState] = useState<Theme>(defaultTheme);

         const resolvedTheme = theme === 'system'
           ? (systemColorScheme ?? 'light')
           : theme;

         useEffect(() => {
           // Update NativeWind color scheme when theme changes
           setColorScheme(resolvedTheme);
         }, [resolvedTheme, setColorScheme]);

         const setTheme = (newTheme: Theme) => {
           setThemeState(newTheme);
         };

         const toggleTheme = () => {
           const nextTheme = resolvedTheme === 'light' ? 'dark' : 'light';
           setThemeState(nextTheme);
         };

         return (
           <ThemeContext.Provider value={{ theme, resolvedTheme, setTheme, toggleTheme }}>
             {children}
           </ThemeContext.Provider>
         );
       }

       export function useTheme() {
         const context = useContext(ThemeContext);
         if (context === undefined) {
           throw new Error('useTheme must be used within a ThemeProvider');
         }
         return context;
       }
       ```

    3. Update `app/_layout.tsx` to use the new providers:
       ```typescript
       import '../global.css';
       import { ThemeProvider as NavigationThemeProvider } from '@react-navigation/native';
       import { Stack } from 'expo-router';
       import { StatusBar } from 'expo-status-bar';
       import { useColorScheme } from 'react-native';
       import 'react-native-reanimated';

       import { ThemeProvider, useTheme } from '@/components/providers/theme-provider';
       import { RelayProvider } from '@/components/providers/relay-provider';
       import { NAV_THEME } from '@/constants/theme';

       function RootLayoutNav() {
         const { resolvedTheme } = useTheme();

         return (
           <NavigationThemeProvider value={NAV_THEME[resolvedTheme]}>
             <Stack>
               <Stack.Screen name="(tabs)" options={{ headerShown: false }} />
               <Stack.Screen name="modal" options={{ presentation: 'modal', title: 'Modal' }} />
             </Stack>
             <StatusBar style={resolvedTheme === 'dark' ? 'light' : 'dark'} />
           </NavigationThemeProvider>
         );
       }

       export default function RootLayout() {
         return (
           <RelayProvider>
             <ThemeProvider>
               <RootLayoutNav />
             </ThemeProvider>
           </RelayProvider>
         );
       }
       ```

    4. Add theme toggle to Profile screen for testing:
       ```typescript
       // In app/(tabs)/profile.tsx
       import { View } from 'react-native';
       import { Text } from '@/components/ui/text';
       import { Button } from '@/components/ui/button';
       import { useTheme } from '@/components/providers/theme-provider';

       export default function ProfileScreen() {
         const { resolvedTheme, toggleTheme } = useTheme();

         return (
           <View className="flex-1 items-center justify-center bg-background p-4">
             <Text className="text-2xl font-bold mb-2">Profile</Text>
             <Text className="text-muted-foreground mb-4">
               Your profile details
             </Text>
             <Button variant="outline" onPress={toggleTheme}>
               Switch to {resolvedTheme === 'light' ? 'Dark' : 'Light'} Mode
             </Button>
           </View>
         );
       }
       ```
  </action>
  <verify>
    - App renders with correct light mode colors by default
    - Tapping theme toggle button switches colors throughout app
    - Navigation bar colors match theme
    - Status bar style matches theme (dark icons on light, light icons on dark)
    - Tab bar colors respond to theme change
  </verify>
  <done>
    Theme provider with toggle, navigation theme, and proper color scheme switching.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. `npx expo start -c` - App launches with themed colors
2. Light mode: Light background, dark text
3. Tap theme toggle on Profile: Colors switch to dark mode
4. Dark mode: Dark background, light text
5. Navigation bar and status bar match theme
6. All screens show consistent themed colors
</verification>

<success_criteria>
- UI components render with OKLCH-derived colors matching selah-web
- Dark mode applies different color scheme throughout app
- Light mode applies different color scheme throughout app
- Theme toggle correctly switches between dark and light modes
- Tab bar, navigation bar, and status bar all respond to theme changes
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-04-SUMMARY.md`
</output>
